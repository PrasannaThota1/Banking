{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { Chart, registerables } from 'chart.js';\nimport { AccountService } from '../services/account.service';\nimport { AuthService } from '../services/auth.service';\nimport { TransactionService } from '../services/transaction.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/account.service\";\nimport * as i2 from \"../services/transaction.service\";\nimport * as i3 from \"../services/auth.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/router\";\nfunction DashboardPage_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \" No accounts yet. \");\n    i0.ɵɵelementStart(2, \"a\", 12);\n    i0.ɵɵtext(3, \"Create one\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardPage_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"div\")(2, \"div\", 14);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"strong\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"strong\", 15);\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const account_r3 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(account_r3.account_type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(account_r3.account_number);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(8, 3, account_r3.balance, \"1.2-2\"));\n  }\n}\nfunction DashboardPage_div_31_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵtext(1, \"No pending requests\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardPage_div_31_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\")(2, \"div\", 2);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"strong\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 2);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 19)(9, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function DashboardPage_div_31_div_4_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const r_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.approve(r_r6.id));\n    });\n    i0.ɵɵtext(10, \"Approve\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function DashboardPage_div_31_div_4_Template_button_click_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const r_r6 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r9.reject(r_r6.id));\n    });\n    i0.ɵɵtext(12, \"Reject\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const r_r6 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"User ID: \", r_r6.user_id, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", r_r6.account_type, \" - \", r_r6.branch || \"Any branch\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Initial Deposit: \", r_r6.initial_deposit, \"\");\n  }\n}\nfunction DashboardPage_div_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"h4\");\n    i0.ɵɵtext(2, \"Pending Account Requests\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, DashboardPage_div_31_div_3_Template, 2, 0, \"div\", 16)(4, DashboardPage_div_31_div_4_Template, 13, 4, \"div\", 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.pendingRequests || ctx_r2.pendingRequests.length === 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.pendingRequests);\n  }\n}\nChart.register(...registerables);\nexport let DashboardPage = /*#__PURE__*/(() => {\n  class DashboardPage {\n    constructor(accountService, transactionService, authService) {\n      this.accountService = accountService;\n      this.transactionService = transactionService;\n      this.authService = authService;\n      this.summary = null;\n      this.loading = true;\n      this.error = null;\n      this.isAdmin = false;\n      this.pendingRequests = [];\n    }\n    ngOnInit() {\n      this.loadDashboard();\n    }\n    loadDashboard() {\n      this.isAdmin = this.authService.getCurrentUser()?.role === 'ADMIN';\n      this.accountService.getAccountsList().subscribe({\n        next: accounts => {\n          // Calculate dashboard summary from accounts\n          const totalBalance = accounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);\n          this.summary = {\n            total_balance: totalBalance,\n            account_count: accounts.length,\n            accounts: accounts\n          };\n          // Load transaction history to count recent transactions\n          this.transactionService.getHistory(5).subscribe({\n            next: txns => {\n              this.summary.recent_transactions = Array.isArray(txns) ? txns.length : 0;\n              this.loading = false;\n              this.renderChart();\n            },\n            error: () => {\n              this.loading = false;\n              this.renderChart();\n            }\n          });\n          if (this.isAdmin) {\n            this.accountService.listRequests().subscribe({\n              next: reqs => this.pendingRequests = reqs || [],\n              error: e => console.error('Failed to load pending requests', e)\n            });\n          }\n        },\n        error: err => {\n          this.error = 'Failed to load dashboard';\n          this.loading = false;\n          console.error(err);\n        }\n      });\n    }\n    renderChart() {\n      setTimeout(() => {\n        const ctx = document.getElementById('overviewChart')?.getContext('2d');\n        if (!ctx) return;\n        this.chart = new Chart(ctx, {\n          type: 'line',\n          data: {\n            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n            datasets: [{\n              label: 'This Year',\n              data: [1200, 1500, 1800, 1400, 1700, 2000, 2200, 2400, 2300, 2100, 2500, 2700],\n              borderColor: '#4f46e5',\n              backgroundColor: 'rgba(79,70,229,0.08)',\n              tension: 0.35\n            }, {\n              label: 'Last Year',\n              data: [900, 1100, 1300, 1200, 1400, 1600, 1800, 1700, 1600, 1500, 1700, 1900],\n              borderColor: '#06b6d4',\n              backgroundColor: 'rgba(6,182,212,0.06)',\n              tension: 0.35\n            }]\n          },\n          options: {\n            responsive: true,\n            scales: {\n              x: {\n                grid: {\n                  display: false\n                },\n                ticks: {\n                  color: '#9aa6bb'\n                }\n              },\n              y: {\n                grid: {\n                  color: 'rgba(255,255,255,0.03)'\n                },\n                ticks: {\n                  color: '#9aa6bb'\n                }\n              }\n            },\n            plugins: {\n              legend: {\n                labels: {\n                  color: '#cbd5e1'\n                }\n              }\n            }\n          }\n        });\n      }, 100);\n    }\n    approve(requestId) {\n      if (!confirm('Approve this account request?')) return;\n      this.accountService.approveRequest(requestId).subscribe({\n        next: () => {\n          this.pendingRequests = this.pendingRequests.filter(r => r.id !== requestId);\n          alert('Request approved and account created');\n        },\n        error: e => {\n          console.error(e);\n          alert('Failed to approve request');\n        }\n      });\n    }\n    reject(requestId) {\n      const reason = prompt('Reason for rejection') || 'Rejected by admin';\n      this.accountService.rejectRequest(requestId, reason).subscribe({\n        next: () => {\n          this.pendingRequests = this.pendingRequests.filter(r => r.id !== requestId);\n          alert('Request rejected');\n        },\n        error: e => {\n          console.error(e);\n          alert('Failed to reject request');\n        }\n      });\n    }\n    static {\n      this.ɵfac = function DashboardPage_Factory(t) {\n        return new (t || DashboardPage)(i0.ɵɵdirectiveInject(i1.AccountService), i0.ɵɵdirectiveInject(i2.TransactionService), i0.ɵɵdirectiveInject(i3.AuthService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardPage,\n        selectors: [[\"dashboard-page\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 32,\n        vars: 9,\n        consts: [[1, \"card\", \"mb-4\"], [1, \"overview-header\"], [1, \"muted\"], [\"id\", \"overviewChart\", 1, \"overview-chart\"], [1, \"stats-grid\"], [1, \"card\"], [1, \"stat-label\"], [1, \"accent\", \"stat-value\"], [\"class\", \"muted empty-state\", 4, \"ngIf\"], [\"class\", \"account-item\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"card\", 4, \"ngIf\"], [1, \"muted\", \"empty-state\"], [\"routerLink\", \"/accounts\", 1, \"accent-link\"], [1, \"account-item\"], [1, \"muted\", \"account-type\"], [1, \"account-balance\"], [\"class\", \"muted\", 4, \"ngIf\"], [\"class\", \"request-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"request-item\"], [2, \"display\", \"flex\", \"gap\", \"0.5rem\"], [1, \"btn\", \"btn-sm\", 3, \"click\"], [1, \"btn\", \"btn-sm\", \"btn-outline\", 3, \"click\"]],\n        template: function DashboardPage_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\")(1, \"div\", 0)(2, \"div\", 1)(3, \"div\")(4, \"h3\");\n            i0.ɵɵtext(5, \"Overview\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"div\", 2);\n            i0.ɵɵtext(7, \"Year-to-date\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelement(8, \"canvas\", 3);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"div\", 4)(10, \"div\", 5)(11, \"div\", 6);\n            i0.ɵɵtext(12, \"Total Balance\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"strong\", 7);\n            i0.ɵɵtext(14);\n            i0.ɵɵpipe(15, \"number\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(16, \"div\", 5)(17, \"div\", 6);\n            i0.ɵɵtext(18, \"Accounts\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"strong\", 7);\n            i0.ɵɵtext(20);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"div\", 5)(22, \"div\", 6);\n            i0.ɵɵtext(23, \"Recent Transactions\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"strong\", 7);\n            i0.ɵɵtext(25);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(26, \"div\", 5)(27, \"h4\");\n            i0.ɵɵtext(28, \"Your Accounts\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(29, DashboardPage_div_29_Template, 4, 0, \"div\", 8)(30, DashboardPage_div_30_Template, 9, 6, \"div\", 9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(31, DashboardPage_div_31_Template, 5, 2, \"div\", 10);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(14);\n            i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 6, (ctx.summary == null ? null : ctx.summary.total_balance) || 0, \"1.2-2\"));\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate((ctx.summary == null ? null : ctx.summary.account_count) || 0);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate((ctx.summary == null ? null : ctx.summary.recent_transactions) || 0);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", !(ctx.summary == null ? null : ctx.summary.accounts) || ctx.summary.accounts.length === 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.summary == null ? null : ctx.summary.accounts);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isAdmin);\n          }\n        },\n        dependencies: [CommonModule, i4.NgForOf, i4.NgIf, i4.DecimalPipe, RouterModule, i5.RouterLink],\n        styles: [\".overview-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.overview-chart[_ngcontent-%COMP%]{width:100%;height:260px}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}.stat-label[_ngcontent-%COMP%]{font-size:.85rem}.stat-value[_ngcontent-%COMP%]{font-size:1.4rem}.empty-state[_ngcontent-%COMP%]{padding:1rem}.accent-link[_ngcontent-%COMP%]{color:var(--accent)}.account-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid rgba(255,255,255,.03)}.account-type[_ngcontent-%COMP%]{font-size:.85rem}.account-balance[_ngcontent-%COMP%]{color:var(--accent)}\"]\n      });\n    }\n  }\n  return DashboardPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}